# 指令集

- ISA的产生

- 区分计算机体系结构和微结构
  - 体系结构(computer architecture)定义的是硬件和软件的接口，并没有指定实现。RISC-V即定义的体系结构。
  - 微结构(processor microarchitecture)则描述的是如何设计一个处理器来符合一个体系结构。体系结构并不定义微结构。

- 指令级架构(instruction set architecture, ISA)
  - ISA定义的内容：指令编码，内存模型，IO模型，逻辑寄存器数量和功能，控制寄存器，特权级别。
  - 一条指令都包含什么： 指令功能，操作对象(立即数，普通寄存器，特殊寄存器，内存), 环境变量(标志位，特权级别)，指令编码。
  - 指令的功能分类：逻辑指令，数学指令，控制指令，内存指令，IO指令，特殊指令。
  - CISC和RISC
- 处理器微结构
  - 流水线
  - 多发乱序流水线
  - 多线程流水线
  - 多核
  - 特殊流水线：VLWI, vector, GPU
- 体系结构与微结构的互相影响
  - 比较CISC和RISC的特性。
  RISC的每条指令功能复杂度基本一致，执行时间基本一致，编码长度基本一致，流水线控制简单，指令调度简单，代码密度相对CISC较小。
  CISC的指令功能复杂度不一，执行时间长短不一，编码长度也不一样。直接运行导致流水线控制复杂调度困难，一般动态拆做类似RISC的微指令执行。代码密度相对RISC较高。
  - 操作数：单指令寄存器个数。从栈寻址到多寄存器寻址在代码密度，流水线调度，执行时间上的考虑。
  - 操作数：内存寻址方式。RISC的内存寻址方式单一，调度简单，可做单独流水线，但指令密度高。CISC调度方式复杂，流水线设计复杂，指令密度高。
  - 环境变量： 条件执行对流水线的影响。（第二章具体讲）
  - 指令编码：RISC编码和SISC编码，解码难度，取址难度，分支预测难度等等。（第二章具体讲RISC-V的编码设计）
  - 编译器：
    编译器是指令集和高级语言的接口。
    语言的抽象等级越高，ISA的使用就更加受限：ABI，systemcall，context switching。
    通用逻辑寄存器的功能异化，数量对编译器的影响。
  - 操作系统：硬件资源的管理者，特权软件。
    操作系统需要ISA的支持：控制寄存器，特权指令，内存模型，IO模型等等，hyervisor模式。
    （更具体的，比如对VM，安全，上下文切换效率，中断和异常的定义等等，都留到第二章）